---
title: "shoredate: Dating Stone Age sites on the Norwegian Skagerrak coast"
author: "Isak Roalkvam"
output:
  rmarkdown::html_vignette:
    number_sections: true
    toc: true
    self_contained: yes
    md_extensions: [ 
      "-autolink_bare_uris" 
    ]
fontsize: 11pt
documentclass: article
vignette: >
  %\VignetteIndexEntry{shoredate: Dating Stone Age sites on the Norwegian Skagerrak coast}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```{r rmd_setup, include = FALSE}
knitr::opts_chunk$set(fig.align = "center")
```

```{r load, include = FALSE}
spatial_limit <- sf::st_read(system.file("extdata/spatial_limit.gpkg",
                                              package = "shoredate",
                                              mustWork = TRUE), quiet = TRUE)
```

# Introduction
The concept of dating sites based on their present-day elevation with reference to past shoreline displacement has been an important tool for archaeologists in northern Scandinavia since the early 1900s (e.g. Brøgger 1905). This is based on the observation that Stone Age sites in the region tend to have been located close to the contemporaneous shoreline when they were in use. Following the retreat of the Fennoscandian Ice Sheet, the isostatic uplift has been so severe that despite corresponding eustatic sea-level rise, the relative sea-level has been falling throughout prehistory in large parts of this region. Within any given area where this is the case, the general pattern is thus that older sites will be located at higher altitudes than younger sites. 

This vignette describes the R package shoredate which provides tools for shoreline dating Stone Age sites located on the Norwegian Skagerrak coast using the approach presented in Roalkvam (2023). This is based on the an empirical evaluation of the likely elevation of the sites above sea-level when they were in use, and the local trajectory of past relative sea-level change. Due to the geographical contingency of the method, and the dependency on geological reconstructions of shoreline displacement, the package is at present limited to coastal sites located in the region stretching from Horten county in the north east, to Arendal county in the south west. Spatial data to be used with the package should be set to the coordinate system WGS84 / UTM zone 32N (EPSG:32632).

## Installing and loading shoredate

The package can be installed from the [GitHub repository](https://github.com/isakro/shoredate). This requires the devtools package.

```{r install, eval = FALSE}
# Uncomment and run to install devtools
# install.packages("devtools")

# Installation requires devtools
devtools::install_github("isakro/shoredate")
```

Note that the package is being actively developed and could be unstable. When installed the package is loaded by calling the `library()` function.
```{r setup, message = FALSE, warning = FALSE}
library(shoredate)
```

## Geographical and temporal coverage

Shoreline dating of Stone Age sites in northern Scandinavia is based on the premise that coastal sites within the region tend to have been located on or close to the shoreline when they were in use. By reconstructing the past trajectory of shoreline displacement this thus allows us to ascribe an approximate date to when the sites were in use, based on their present-day elevation. The method is therefore dependent on local relative sea-level change and the likely elevation of the sites above sea-level when they were in use. 

As the method is dependent on good geological reconstructions of shoreline displacement, shoredate is at present limited to being applicable in the region of south-eastern Norway between Horten in the north east to Arendal in the south west. This region has recently compiled shoreline displacement curves for Horten (Romundset 2021), Larvik (Sørensen et al. 2014a; Sørensen et al. *in prep*), Tvedestrand (Romundset 2018; Romundset et al. 2018) and Arendal (Romundset 2018). This region also formed the study area for Roalkvam (2023), in which the specification of the method and the parameters used here were derived. The spatial coverage of shoredate is indicated in the maps below:

```{r maps, echo = FALSE, warning = FALSE, fig.width = 7, fig.height = 10, fig.align='center'}
# Make sure labels end up in the same, reasonable position each time
set.seed(12)

# Find coordinates for bounding box to plot
limit_reproj <- sf::st_transform(spatial_limit, crs = 4326)
limit_bbox <- as.numeric(sf::st_bbox(limit_reproj))

# Retrieve background map with ggmap and create plot
plt1 <- ggmap::ggmap(ggmap::get_stamenmap(bbox = c(left = 2, bottom = 54,
                               right = 32, top = 71.5), zoom = 5,
                maptype = 'terrain-background', source = 'stamen')) +
  ggplot2::geom_rect(
    xmin = limit_bbox[1],
    ymin = limit_bbox[2],
    xmax = limit_bbox[3],
    ymax = limit_bbox[4],
    fill = NA, 
    colour = "black",
    linewidth = 0.5)

# Use the target_plot() function from this package as the basis for the map
plt2 <- target_plot() +  
    ggplot2::labs(
    subtitle = "Spatial limit and shoreline isobases\nCRS: WGS 84 / UTM zone 32N (EPSG:32632)") +
  ggplot2::theme_bw() + ggplot2::theme(axis.title = ggplot2::element_blank(),
                     rect = ggplot2::element_rect(),
                     panel.grid.major = ggplot2::element_blank(),
                     legend.position = "none") 

# Display displacement curves
plt3 <- displacement_plot() + 
  ggplot2::labs(subtitle = "Shoreline displacement curves")

patchwork::wrap_elements((plt1 + plt2) / plt3)
```

A warning is given if one attempts to date a site located outside the spatial extent outlined above. However, as there might still be use-cases where it could be useful to apply the method outside this limit, the dating procedure is still performed.

Furthermore, as human occupation in the region only occurred some time after the retreat of the ice, the oldest known sites are dated to around 9300 BCE (e.g. Glørstad 2016). The oldest possible age to achieve with shoredate is 9460 BCE, although no sites are yet known to be that old. 9460 BCE is the latest start date among the geologically derived displacement curves. If a site has an elevation that implies a date older than 9460 BCE, the date is returned as NA and a warning is given. However, do note that what date any given elevation equates to will vary across the region, as this is determined by local shoreline displacement. 

# Interpolating shoreline displacement to a site location

The function `shoreline_date()` forms the basis for shoredate, and is presented in more detail below. When calling `shoreline_date()` the trajectory of shoreline displacement at the location of the sites to be dated is interpolated under the hood, based on the four different geological reconstructions of shoreline displacement in the region. Each of these are associated with a shoreline isobase which indicates contours along which the relative sea-level change has followed the same trajectory. The variation in the rate of sea-level change is mainly determined by the degree of isostatic uplift, which is higher along a gradient than runs from the south west to the north east within the region. The shoreline displacement curve for any given location is interpolated using the `interpolate_curve()` command, using inverse distance weighting, where the distance to the four isobases is weighted by the square of the inverse distances.

```{r interpolate, fig.width = 6, fig.height = 5, warning = FALSE}
# Create example point using the required coordinate system WGS84 / UTM zone 32N (EPSG:32632)
target_point <- sf::st_sfc(sf::st_point(c(517324, 6527377)), crs = 32632)

# Interpolate the displacement curve
target_curve <- interpolate_curve(target_point)
```

To visualise the interpolated curve alongside the geological reconstructions, the curve can be passed to `displacement_plot()`. A simple map showing the location of one or more target sites relative to the isobases can also be displayed by using the command `target_plot()`.

```{r plot_intcurve, fig.width = 8, fig.height = 8, warning = FALSE, message = FALSE}

# Store the plots to be passed to patchwork for plotting
target_disp <- displacement_plot(target_curve)
locaton_plot <- target_plot(target_point)

# Use the package patchwork to plot these together
patchwork::wrap_plots(locaton_plot / target_disp)
```

# Shoreline dating a site

The following section outlines how to perform a shoreline date using the default settings. Various variables and helper-functions underlying the dating procedure are also presented, along with ways to manipulate these if one wishes to explore the sensitivity of the dates or believe other parameters than the defaults are more sensible in a given setting.

To perform a basic shoreline date, a site has to be provided as a spatial `sf` object. In a addition to this, the elevation of the site above the present sea-level has to be provided. This can either be done by manually specifying the elevation, or by providing an elevation raster. The elevation of the site will then be derived from the raster. If the site has a spatial extent (i.e. is not a point feature) the mean elevation of the feature is used as the default. In Roalkvam (2023) it was found that the vertical distance from the sites to the contemporaneous shoreline within the study region could be reasonably approximated by a gamma distribution. This forms the foundation for the implementation of shoreline dating in the package.

```{r example_site, message = FALSE}
# Date the example point, using a fictitious elevation value
target_date <- shoreline_date(target_point, elevation = 65)
```

The results can then be plotted using the `shoredate_plot()` command:

```{r plot_example, fig.width = 4, fig.height = 3.5}
# Call to plot
shoredate_plot(target_date)
```

The blue gamma distribution on the y-axis indicates the likely elevation of the site above sea-level when it was in use, which is described by an empirically derived gamma distribution with the parameters shape ($\alpha$) = 0.286 and scale ($\sigma$) = 0.048. These parameters can be adjusted by specifying the values passed to `model_parameters` when calling `shoreline_date()`. The red envelope is the shoreline displacement curve as interpolated to the site location. Transferring the probability from the gamma distribution to the calendar scale using the displacement curve gives the resulting shoreline date in grey, which is underlined with the 95% highest density region (HDR) in black. The coverage of the HDR can be adjusted with the `hdr_prob` parameter. The dating procedure involves stepping through the cumulative version of the gamma distribution, and at each step subtracting the probability at the previous step from the current one. The probability at each step is divided uniformly across the calendar years in the range between the lower and upper limit of the displacement curve. The default resolution on the calendar scale is 10 years, but this can be adjusted by specifying the `cal_reso` argument. The gamma distribution is stepped through using increments of 0.01, but this can be set to any value using the argument `elev_reso`. By default, the resulting shoreline date is normalised to sum to unity.

The function `shoreline_date()` returns an object of class `shoreline_date`. By calling the object the dates are printed to console, displaying site name, elevation and HDR:

```{r}
target_date
```

It is also possible to plot a more sparse version of the date by specifying what elements are to be excluded. For example:

```{r sparse, fig.width = 4, fig.height = 3.5}
shoredate_plot(target_date,  elevation_distribution = FALSE,
               displacement_curve = FALSE, highest_density_region = FALSE)
```

It is also possible to date multiple sites at once, as exemplified in the code chunks to follow.

```{r multipoint, fig.width = 5, fig.height = 5}
# Create multiple example points to be dated
target_points <- sf::st_sfc(sf::st_point(c(576052, 6567955)),
                              sf::st_point(c(554212, 6538835)),
                              sf::st_point(c(516599, 6512142)))
                              
# Specify the correct CRS and make the points a sf data frame to add the column below
target_points <- sf::st_as_sf(target_points, crs = 32632)

# The first column of a data frame beyond the "geom" column holding the sf geometry will be
# used as site names. If no such column is present, the sites will simply be numbered as they
# are passed to shoreline_date(). Adding example site names:
target_points$names <- c("Site 1", "Site 2", "Site 3")
                              
# Create a plot showing the location of points within the spatial limit
target_plot(target_points)
```

```{r multidate}
# Dating the target points, specifying the elevations in a vector of numeric values.
target_dates <- shoreline_date(target_points, elevation = c(68, 98, 73))

# Print results
target_dates
```

The default behaviour when passing multiple dates is to plot a series of individual plots for each date. However, setting `multiplot = TRUE` when calling `shoredate_plot()` collapses the dates on a single, more sparse plot. The sites are ordered from from earliest to latest possible start date for the occupation of the sites. 

```{r multiplot, fig.width = 6, fig.height = 6}
# Call to plot, specifying multiplot = TRUE.
shoredate_plot(target_dates, multiplot = TRUE)
```


## Direction of uplift gradient
The precise direction of the uplift gradient is specified by the isobases that run perpendicular to this gradient. When interpolating the displacement curve used for dating a site, the direction of these isobases defaults to 327$^\circ$, following Romundset et al. (2018:180, fig.1). However, some authors operate with different isobase directions, with Sørensen et al. (2014:fig.2.2.3) using 338$^\circ$, and the direction of the uplift gradient might have varies throughout the Holocene (Sørensen et al. 2014:42--44). While the range of the typically employed isobase directions generally result in minor differences in the resulting shoreline dates, it is possible to specify other and multiple directions for these, and perform the shoreline date using each individual direction. This can be useful either for evaluating the sensitivity of a date or if one believes there is reason suspect a different direction than the default in a particular case.

```{r example_site_isobases, message = FALSE}
# Using the same target point and elevation as above, but specifying two different directions
# for the isobases.
iso_date <- shoreline_date(site = target_point, elevation = 65, isobase_direction = c(325, 338))
```

In the call to plot it can then be specified that the direction of the isobases is displayed with each date. Note that it is not possible use `multiplot` when having used multiple isobase directions when dating the sites. The following thus also shows the default behaviour when plotting multiple dates at once and not setting `multiplot = TRUE`.

```{r plot_example_isobases, fig.width = 6, fig.height = 8, warning = FALSE, message = FALSE}
shoredate_plot(iso_date, isobase_direction = TRUE)
```

# References

Brøgger, W.C. 1905 *Strandliniens beliggenhed under stenalderen i det sydøstlige Norge*. Geological Survey of Norway, Kristiania. URI: https://hdl.handle.net/11250/2675184

Glørstad, H. 2016 Deglaciation, sea-level change and the Holocene colonization of Norway. *Geological Society, London, Special Publications* 411(1):9--25. DOI: [10.1144/SP411.7](https://doi.org/10.1144/SP411.7)

Romundset, A. 2018. Postglacial shoreline displacement in the Tvedestrand--Arendal area. In *The Stone Age Coastal Settlement in Aust-Agder, Southeast Norway*, edited by Gaute, Reitan and Lars Sundström. Cappelen Damm Akademisk, Oslo, pp. 463--478. DOI: [10.23865/noasp.50](https://doi.org/10.23865/noasp.50)

Romundset, A. 2021 *Resultater fra NGUs undersøkelse av etteristidas strandforskyvning nord i Vestfold*. Geological Survey of Norway, Trondheim.

Romundset, A., Lakeman, T.R. and Høgaas, F. 2018. Quantifying variable rates of postglacial relative sea level fall from a cluster of 24 isolation basins in southern Norway. *Quaternary Science Reviews* 197:175e192. DOI: [10.1016/ j.quascirev.2018.07.041](https://doi.org/10.1016/j.quascirev.2018.07.041)

Roalkvam, I. 2023 A simulation-based assessment of the relation between Stone Age sites and relative sea-level change along the Norwegian Skagerrak coast. *Quaternary Science Reviews* 299:107880. DOI: [10.1016/j.quascirev.2022.107880](https://doi.org/10.1016/j.quascirev.2022.107880)

Sørensen, R, Henningsmoen, K.E. Høeg, H.I. and Gälman V. 2023. Holocen vegetasjonshistorie og landhevning i søndre Vestfold og sørøstre Telemark. In *The Stone Age in Telemark. Archaeological Results and Scientific Analysis from Vestfoldbaneprosjektet and E18 Rugtvedt--Dørdal*, edited by Per Persson and Steinar Solheim, in press.  

Sørensen, R, Henningsmoen, K.E. Høeg, H.I. and Gälman V. 2014 Holocene landhevningsstudier i søndre Vestfold og sørøstre Telemark -- Revidert kurve. In *Vestfoldbaneprosjektet. Arkeologiske undersøkelser i forbindelse med ny jernbane mellom Larvik og Porsgrunn. Bind 1*, edited by Stine Melvold and Per Persson. Portal forlag, Kristiansand, pp. 36--47. DOI: [10.23865/noasp.61](https://doi.org/10.23865/noasp.61)
